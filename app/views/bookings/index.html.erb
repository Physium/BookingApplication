<% content_for :avoid_default_main do %>
  <div class="container">
    <p id="notice"><%= notice %></p>

    <h1>Upcoming Bookings</h1>

    <%= link_to 'New Booking', new_booking_path, class: "btn btn-primary mb-4 mt-2"%>

    <table class="table table-striped">
      <thead>
        <tr>
          <th>Booking Date</th>
          <th>Start time</th>
          <th>End time</th>
          <th>Room</th>
          <th>User</th>
          <th>Title</th>
          <th class="text-center" colspan="3">Actions</th>
        </tr>
      </thead>

      <tbody>
        <% @current_user_bookings.each do |booking| %>
          <tr>
            <td><%= booking.start_time.strftime('%F(%A)') %></td>
            <td><%= booking.start_time.strftime("%I:%M %p") %></td>
            <td><%= booking.end_time.strftime("%I:%M %p") %></td>
            <td><%= booking.room.name %></td>
            <td><%= booking.user.username %></td>
            <td><%= booking.title %></td>
            <td><%= link_to 'Show', booking , class: "btn btn-success" %></td>
            <td><%= link_to 'Edit', edit_booking_path(booking), class:"btn btn-warning" %></td>
            <td><%= link_to 'Destroy', booking, method: :delete, data: { confirm: 'Are you sure?' } , class:"btn btn-danger" %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
    
    <br>
    <hr class="mb-4">
    <%= month_calendar(events: @bookings)  do |date, bookings| %>
      <%= date %>

      <% bookings.each do |booking| %>
        <% if current_user.id == booking.user_id %>
        <div class="alert alert-success">
        <% else %>
        <div class="alert alert-secondary">
        <% end %>
          <%= link_to booking.room.name + ": " + booking.start_time.strftime("%I:%M %p") + "-" + booking.end_time.strftime("%I:%M %p") + " (" + booking.user.username + ")", booking %>
        </div>
      <% end %>
    <% end %>
  </div>
<% end %>